"use strict";StackExchange.tagEditor=function(e,t,n,i){function o(){q=!0}function r(){if("undefined"==typeof ut){for(var e=StackExchange.tagEditor.requiredTags,t=[],n=0;n<e.length;n++)t.push(p(e[n]).replace(/[.+]/g,"\\$&"));ut=new RegExp("^(?:"+t.join("|")+")$")}return ut}function a(){if(!i.ignoreRequired){var e=StackExchange.tagEditor.requiredTags;if(e&&/^ ?$/.test(ot.val())){var t=r();0===it.add(rt).children().filter(function(){return t.test($(this).text())}).length&&_(StackExchange.tagEditor.requiredTags)}}}function s(e,t){var n=window.tagRenderer(e,null,"span");return i.tagMenus&&n.data("tag-menu-tagname",e),t||(n.append($("<span>",{"class":"delete-tag","title":i.tooltipDeleteTag||"quitar esta etiqueta"})),z.trigger("tagSpanCreated",[n])),i.tagSpanCreated&&i.tagSpanCreated(n),n}function c(e){var t=$([]),n=$([]);switch(e){case vt.all:t=it.find(".rendered-element"),n=rt.find(".rendered-element");break;case vt.left:t=it.find(".rendered-element:last");break;case vt.right:n=rt.find(".rendered-element:first");break;case vt.all_left:t=it.find(".rendered-element");break;case vt.all_right:n=rt.find(".rendered-element")}return{"pre":t,"post":n}}function l(e){e=e||vt.all;var t=c(e),n=t.pre.map(function(e,t){return $(t).text()}).get(),i=n.join(" ");i.length&&(i+=" ");var o=t.post.map(function(e,t){return $(t).text()}).get(),r=o.join(" ");r.length&&ot.val().length&&(r=" "+r);var a=ot.val();return n=n.concat(o),{"text":i+ot.val()+r,"lengthBeforeInput":i.length,"val":a,"tags":n}}function u(t){t=t||l(),setTimeout(function(){e.trigger("tageditor:renderedchange",[t.tags,t.val])})}function d(){var e=ot.val();return(""===e||" "===e)&&0===it.add(rt).children().filter(function(){return!/^\s*$/.test($(this).text())}).length}function p(e){return i.getTagNameFromData?i.getTagNameFromData(e):e.Name}function f(e){e=e||vt.all;var t=ot.caret(),n=ot[0].selectionDirection,i=c(e);if(i.pre.add(i.post).length){var o=l(e);ot.val(o.text),i.pre.remove(),i.post.remove(),ot.caret(t.start+o.lengthBeforeInput,t.end+o.lengthBeforeInput),Z&&(ot[0].selectionDirection=n),L(),u()}}function h(e){if(i.operators&&i.operators.test(e))return $("<span class='rendered-element'/>").text(e);var t=s(e).addClass("rendered-element");return g(e)||t.addClass("invalid-tag").attr("title",i.tooltipInvalidTag||"etiqueta inválida"),t}function g(e){return i.invalid&&i.invalid[e]?!1:i.isTagValid&&!i.isTagValid(e)?!1:!0}function m(t){if(!dt){var n;if(n=t?{"start":ot.val().length,"end":ot.val().length}:ot.caret(),-1==n.start&&(n.start=n.end=0),!Z&&n.start!==n.end)return f(),w(),void 0;var o=ot.val(),r=o.substr(0,n.start),s=o.substr(n.end),c=ot[0].selectionDirection,p=(r+"!").split(/[,;\s]+/);p[p.length-1]="!"===p[p.length-1]?"":p[p.length-1].slice(0,-1);var g=s.split(/[,;\s]+/),m=p.pop(),v=m.length;m+=o.substring(n.start,n.end),m+=g.shift(),p=E(p.join(" ")),g=E(g.join(" "));var b,y=!!p.length||!!g.length;for(b=0;b<p.length;b++)h(p[b]).appendTo(it);for(b=0;b<g.length;b++)h(g[b]).appendTo(rt);m!==ot.val()&&ot.val(m);var x={};z.find(".rendered-element").filter(function(){var e=$(this).text();return/^\s*$/.test(e)?!0:x[e]===!0?!0:(i.operators&&i.operators.test(e)||(x[e]=!0),!1)}).remove();var k=l(),S=$.trim(k.text);S!=e.val()&&(e.val(S).trigger("change"),StackExchange.MarkdownEditor&&!i.ignoreStyleCode&&styleCode.updateLangdivDelayed.trigger(S.split(/ /g))),y&&u(k),q&&(ot.caret(v,v+n.end-n.start),Z&&(ot[0].selectionDirection=c),T(),a()),w(),d()?ot.attr("placeholder",V):ot.attr("placeholder","")}}function v(e,t,n,i){var o,r;if("string"==typeof e)r=e;else{if(!e.length)return;o=e,r=o.text()}for(var a=E(ot.val()),s=0;s<a.length;s++)h(a[s]).appendTo(it);if(ot.val(r),o){var c=$($.unique(o.prevAll(".rendered-element").get()));o.nextAll(".rendered-element").prependTo(rt),c.appendTo(it),o.remove()}else rt.find(".rendered-element").appendTo(it);(q||!n)&&ot.focus(),t&&ot.caret(0,0),i||u()}function b(e){var t=e.val(),n="c_"+t;if(n in bt)return bt[n];var i=$("<span />").css({"font-family":e.css("font-family"),"font-size":e.css("font-size"),"display":"inline-block"});i.text(e.val()),i.insertAfter(e);var o=i.innerWidth();return i.remove(),bt[n]=o,o}function y(e){i.multiLine||e!==yt&&(it.add(ot).add(rt).css({"position":"relative","left":e}),yt=e)}function w(){X&&(H=z.innerWidth());var e=b(ot)+19,t=it.outerWidth();if(i.multiLine||rt.children().length||(e=Math.max(e,H-t-8)),ot.css("width",e),i.multiLine){var n=ot.position().top,o=n;if(o>0&&nt>o+tt)return;if(n+z.scrollTop()+tt<nt)return z.scrollTop(0),void 0;z.scrollTop(n-(nt-tt)/2+z.scrollTop())}else{if(t+yt>0&&H>t+yt+e)return;if(H>t+e)return y(0),void 0;y(-t+(H-e)/2)}}function x(e,t){var n;n=e>0?rt.find("> *"):it.find("> *");for(var i,o,r=ot.position(),a=ot.val().length,s=a>0?ot.caret().start/a:.5,c=r.left+ot.width()*s,l=0;l<n.length;l++){var u=n.eq(e>0?l:n.length-l-1),d=u.position();if("undefined"!=typeof o){if(d.top!==o)break}else{var p=Math.abs(d.top-r.top);if(!(p>tt/2))continue;o=d.top}var h=d.left+u.width()/2;if(0>e&&c>h||e>0&&h>c){i=i||u;break}i=u}if(i){if(t){for(;i.parent().length;)f(e>0?vt.right:vt.left);ot.caret(0,ot.val().length)}else v(i);return!0}return!1}function k(){ht=!0,setTimeout(function(){ht=!1},0)}function S(e){if(!Z&&e.shiftKey&&wt[e.which]||e.ctrlKey&&65===e.which)return f(),!0;var t,n,o=ot.caret(),r=ot[0].selectionDirection,a="forward"===r?o.end:o.start,s=a===ot.val().length,c=0===a;switch(e.which){case 37:return c?(t=it.find(".rendered-element:last"),t.length?(e.shiftKey?f(vt.left):v(t),e.shiftKey):!0):!0;case 39:return s?(n=rt.find(".rendered-element:first"),n.length?(e.shiftKey?f(vt.right):v(n,!0),e.shiftKey):!0):!0;case 8:return c?(t=it.find(".rendered-element:last"),t.length?(ot.val(t.text()+ot.val()),ot.caret(t.text().length,t.text().length),t.remove(),u(),!1):!0):!0;case 46:return s?(n=rt.find(".rendered-element:first"),n.length?(ot.val(ot.val()+n.text()),ot.caret(a,a),n.remove(),u(),!1):!0):!0;case 38:if(i.multiLine&&x(-1,e.shiftKey))return!1;case 36:return t=it.find(".rendered-element:first"),t.length?(e.shiftKey?f(vt.all_left):v(t,!0),e.shiftKey):!0;case 40:var l=$(".tag-suggestions > div:first");if(l.length)return k(),l.focus(),!1;if(i.multiLine&&x(1,e.shiftKey))return!1;case 35:return n=rt.find(".rendered-element:last"),n.length?(e.shiftKey?f(vt.all_right):v(n),e.shiftKey):!0;case 9:k();break;case 27:L(),e.preventDefault(!0);break;case 13:if(C())return!1;break;case 32:if(i.spaceSelectsTopSuggestion&&C())return O($(".tag-suggestions > div:first")),!1}return!0}function C(){return!!$(".tag-suggestions").length}function E(e){var t=i.customSafeTags?i.customSafeTags(e):sanitizeAndSplitTags(e,!1,!!i.operators,i.allowUpperCaseTagNames);return t||(t=[]),e&&$.trim(e)&&R('safeTags("{0}") => {1}'.formatUnicorn(e,t.toString())),t}function T(){var e=E(ot.val())[0];return e&&(i.searchTermModifier&&(e=i.searchTermModifier(e)),i.allowUpperCaseTagNames&&(e=e.toLocaleLowerCase())),gt!==e?(gt=e,e&&e.length?(j(e,function(t){e===gt&&q&&_(t,e)}),void 0):(L(),void 0)):void 0}function j(e,t){var n=M(e);xt[n]?t(xt[n]):kt.trigger(e,t)}function I(){return i.tagApiUrl||"/filter/tags"}function M(e){return I()+"|"+e}function _(e,t){$(".tag-suggestions").remove(),dt=!1;var n=e.length;if(0!==n){var o=nt;i.multiLine&&(o=z.height());var r=$("<div class='tag-suggestions box-border' />").css({"position":"absolute","left":z.position().left,"top":z.position().top+o+1,"width":J}).insertAfter(z),a={};z.find(".rendered-element").each(function(){a[$(this).text()]=!0});for(var s=i.suggestionTagBoxRenderer||A,c=0;c<e.length;c++)if(a[p(e[c])]!==!0){var l=s(e[c],t).appendTo(r).attr("tabindex",at||0);P(l),c%N!==0||G||l.css("clear","both")}r.delegate("div","keydown",D),r.delegate("div","click",function(e){$(e.target).is("a")||O($(this))}),r.delegate("div","focus",function(){ht&&1===n?O($(this)):dt=!0}),r.delegate("div","blur",function(){dt=!1})}}function A(e,t){var n=$("<div />").css("width",G?"auto":Q).data("tag-name",e.SynonymOf||p(e));t&&(t=t.replace(/-/g,"").replace(/(.)(?=.)/g,"$1-*").replace(/\+/g,"\\+").replace(/\./g,"\\."));var i=s(p(e),!0),o=i.html();if(t&&(o=o.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),G&&i.addClass("m0"),n.append(i.html(o)),e.Count&&!G&&n.append($("<span class='item-multiplier' />").html("&times;&nbsp;"+e.Count)),U&&!G){var r="";if(e.Excerpt&&(r=e.Excerpt),r.length&&n.append($("<p />").text(r)),e.Synonyms&&e.Synonyms.length)for(var a=$("<p >además:</p>").appendTo(n),c=e.Synonyms.split(/\|/),l=0;l<c.length;l++)r=c[l],t&&(r=r.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),l>0&&(r=", "+r),a.append("<span>"+r+"</span>")}if(B&&!G){var u=e.InfoUrl;u||(u=(e.IsDiverged?StackExchange.options.site.routePrefix:"")+"/tags/"+encodeURIComponent(e.SynonymOf||p(e))+"/info"),n.append("<p class='more-info'><a href='"+u+"' target='_blank'>más información</a></p>")}return n}function P(e){var t=e.find("p.more-info");"undefined"==typeof mt&&(mt=Q-5-t.outerWidth());var n=e.find(".rendered-element:first").outerWidth()+e.find(".item-multiplier").outerWidth();n>mt&&t.find("a").text("información")}function O(e){ot.val(e.data("tag-name")),L(),v(""),m()}function R(e){StackExchange.options.enableLogging&&(console.log("tag editor new: "+e),"string"!=typeof e&&console.log(e))}function L(){$(".tag-suggestions").remove(),dt=!1,kt.cancel()}function D(e){var t;switch(e.which){case 39:case 40:return $(this).next("div").focus(),!1;case 37:return $(this).prev("div").focus(),!1;case 38:return t=$(this).prev("div"),t.length?t.focus():ot.focus(),!1;case 27:return L(),ot.focus(),!1;case 13:case 32:return O($(this)),!1}}var q;if("undefined"==typeof n)try{q=e.is(":focus")}catch(F){q=!1}else q=n;if(e.bind("focus",o),!e.is(":visible"))return t=t||0,3>t?(setTimeout(function(){e.unbind("focus",o),StackExchange.tagEditor(e,t+1,q,i)},300),void 0):(e.unbind("focus",o),$("body.review-task-page").length||StackExchange.debug.log("tag box is invisible, couldn't start tag editor"),void 0);i||(i={});var N=i.columns||3,U="undefined"==typeof i.excerpts||i.excerpts,B="undefined"==typeof i.learnMore||i.learnMore,V=e.attr("placeholder")||"";e.unbind("focus",o);var H=e.innerWidth(),z=$("<div class='tag-editor' />").insertAfter(e);i.extraTagEditorCssClass&&z.addClass(i.extraTagEditorCssClass),["padding-right","padding-left","box-sizing","margin-top","margin-bottom"].forEach(function(t){z.css(t,e.css(t))});var W="border-box"===e.css("box-sizing");W&&(H+=parseInt(z.css("border-right-width"),10)+parseInt(z.css("border-left-width"),10));var J=i.suggestionsWidth||H,Q=(J-12)/N|0,G=i.responsiveIsh&&150>Q;z.css("width",H);var K=e.css("display");e.hide();var Y=getComputedStyle(e[0]).width,X=/%$/.test(Y);X&&z.css("width",Y),"inline"===K&&z.css("display","inline-block"),i.multiLine&&z.addClass("multi-line");var Z="selectionDirection"in e[0],et=$("<span class='post-tag'>test</span>").appendTo(z),tt=W?z.outerHeight():z.innerHeight(),nt=i.multiLine?e.innerHeight():tt;et.remove(),W&&(nt+=parseInt(z.css("border-top-width"),10)+parseInt(z.css("border-bottom-width"),10)),z.css("height",nt);var it=$("<span />").appendTo(z),ot=$("<input type='text' autocomplete='off' tabIndex='0'/>").appendTo(z).val(e.val()+" ").attr("placeholder",V),rt=$("<span />").appendTo(z),at=e.attr("tabIndex"),st=e.attr("id");if(st){var ct=$("label[for='"+st+"']");if(ct.length){var lt="tageditor-replacing-"+st+"--input";ot.attr("id",lt),ct.attr("for",lt)}}at&&ot.attr("tabIndex",at),e.hasClass("s-input")&&(z.addClass("s-input").css({"paddingTop":0,"paddingBottom":0}),ot.addClass("s-input"));var ut,dt=!1,pt=q;ot.focus(function(t,n){q=!0,a(),pt||(n||e.triggerHandler("focus",!0),pt=!0)});var ft=!1;z.mousedown(function(){ft=!0,$(document).one("mouseup",function(){setTimeout(function(){q||(e.triggerHandler("blur"),pt=!1),ft=!1},0)})}),ot.blur(function(){q=!1,setTimeout(function(){dt||(L(),m(),ft||(e.triggerHandler("blur"),pt=!1)),ft=!1},0)}),e.focus(function(e,t){t||ot.trigger("focus",!0)}),ot.keydown(S),ot.bind("keydown paste click change",function(){setTimeout(function(){m()},0)}),z.delegate(".rendered-element","click",function(e){var t=$(this);$(e.target).hasClass("delete-tag")&&t.text(""),v(t),m()}),z.click(function(e){e.target===this&&(v(""),m())}),z.on("rerender",function(){f(),m(!0)});var ht,gt,mt,vt={"left":1,"right":2,"all_left":3,"all_right":4,"all":5},bt={},yt=0,wt={"35":!0,"36":!0,"37":!0,"38":!0,"39":!0,"40":!0},xt={},kt=StackExchange.helpers.DelayedReaction(function(e,t){StackExchange.helpers.addSpinner(z,{"position":"absolute","right":10,"top":nt/2-2});var n=I(),o={"q":e,"newstyle":!0};i.alterQueryParametersBeforeSend&&i.alterQueryParametersBeforeSend(o),$.get(n,o,"json").done(function(n){xt[M(e)]=n,StackExchange.helpers.removeSpinner(),t(n)})},400,{"sliding":!0});m(!0),StackExchange.tagEditor.ready.resolve(),e[0].func_clear=function(){e.val(""),ot.val("").blur(),z.find(".rendered-element").remove()},e[0].func_add=function(e){var t=ot.val();ot.val(e),v(t,!1,!0),m()},e[0].func_finish=function(){v("")},e[0].func_redraw=function(){var t=e.val();e.val(""),ot.val("").blur(),z.find(".rendered-element").remove(),ot.val(t),v("",!1,!0,!0),m()}},StackExchange.tagEditor.ready=$.Deferred();